# チャンネル表示問題 調査報告書

## 作成日時
2025年6月24日

## 概要
チャットのチャンネルが表示されない問題について調査を実施しました。

## 問題の原因

### 1. データベーススキーマの不整合
- **エラー**: `missing destination name bannerinfo in *model.ChannelList`
- **影響**: チャンネル情報の取得時に500エラーが発生
- **原因**: Mattermostのデータベーススキーマが不正な状態

### 2. 権限問題
- **エラー**: `permission=join_private_teams`
- **影響**: sho1ユーザーが船舶チームにアクセスできない
- **解決状況**: ✅ 各チームへのメンバー追加は完了

## 実施した対応

### 1. Mattermostコンテナの再起動
```bash
docker-compose down && docker-compose up -d
```
結果: データベースエラーは解消せず

### 2. チームメンバーへの追加
- sho1ユーザーを全ての船舶チームのメンバーに追加
- 結果: ✅ 成功（権限エラーは解消）

### 3. チャンネル作成の試行
- 各チームにデフォルトチャンネルを作成しようとした
- 結果: ❌ データベースエラーのため失敗

## 現在の状況

### 管理者アカウント（admin）での動作
![管理者での動作確認](/test-results/channel-check-admin/03-after-vessel-select.png)
- ✅ 船舶選択後、正常にダッシュボード表示
- ✅ チーム名「Pacific Glory チーム」が表示
- ❌ チャンネル数: 0（データベースエラーのため）

### 一般ユーザー（sho1）での動作
![sho1での動作確認](/test-results/final-check-sho1/03-after-vessel-select.png)
- ❌ 船舶選択後もエラーが表示
- ❌ ダッシュボードへの遷移が不完全

## 根本的な解決方法

### オプション1: データベースの再初期化（推奨）
```bash
# 1. 既存のデータを削除
docker-compose down -v

# 2. 新しくコンテナを起動
docker-compose up -d

# 3. 初期セットアップを実施
```

### オプション2: Mattermostのアップグレード
- 最新バージョンへのアップグレードでスキーマ問題が解決する可能性

### オプション3: データベースの手動修復
- PostgreSQLに直接接続してスキーマを修正（上級者向け）

## 結論

現在のMattermostインスタンスはデータベーススキーマの不整合により正常に動作していません。クリーンな環境で再セットアップすることを推奨します。

## 成功した部分

1. ✅ 船舶チーム機能の基本的な動作は確認
2. ✅ 権限管理システムは正常に動作
3. ✅ UIは正常に表示される

データベースの問題を解決すれば、チャンネル表示も正常に動作すると考えられます。